const unsetEverything = "font: unset!important; font-feature-settings: unset!important; font-kerning: unset!important; font-optical-sizing: unset!important; font-variation-settings: unset!important; text-orientation: unset!important; text-rendering: unset!important; -webkit-font-smoothing: unset!important; -webkit-locale: unset!important; -webkit-text-orientation: unset!important; -webkit-writing-mode: unset!important; writing-mode: unset!important; zoom: unset!important; place-content: unset!important; place-items: unset!important; place-self: unset!important; alignment-baseline: unset!important; animation: unset!important; appearance: unset!important; backdrop-filter: unset!important; backface-visibility: unset!important; background: unset!important; background-blend-mode: unset!important; baseline-shift: unset!important; block-size: unset!important; border-block: unset!important; border: unset!important; border-radius: unset!important; border-collapse: unset!important; border-inline: unset!important; inset: unset!important; box-shadow: unset!important; box-sizing: unset!important; break-after: unset!important; break-before: unset!important; break-inside: unset!important; buffered-rendering: unset!important; caption-side: unset!important; caret-color: unset!important; clear: unset!important; clip: unset!important; clip-path: unset!important; clip-rule: unset!important; color-interpolation: unset!important; color-interpolation-filters: unset!important; color-rendering: unset!important; color-scheme: unset!important; columns: unset!important; column-fill: unset!important; gap: unset!important; column-rule: unset!important; column-span: unset!important; contain: unset!important; contain-intrinsic-size: unset!important; content: unset!important; content-visibility: unset!important; counter-increment: unset!important; counter-reset: unset!important; counter-set: unset!important; cursor: unset!important; cx: unset!important; cy: unset!important; d: unset!important; display: unset!important; dominant-baseline: unset!important; empty-cells: unset!important; fill: unset!important; fill-opacity: unset!important; fill-rule: unset!important; filter: unset!important; flex: unset!important; flex-flow: unset!important; float: unset!important; flood-color: unset!important; flood-opacity: unset!important; grid: unset!important; grid-area: unset!important; height: unset!important; hyphens: unset!important; image-orientation: unset!important; image-rendering: unset!important; inline-size: unset!important; inset-block: unset!important; inset-inline: unset!important; isolation: unset!important; letter-spacing: unset!important; lighting-color: unset!important; line-break: unset!important; list-style: unset!important; margin-block: unset!important; margin: unset!important; margin-inline: unset!important; marker: unset!important; mask: unset!important; mask-type: unset!important; max-block-size: unset!important; max-height: unset!important; max-inline-size: unset!important; max-width: unset!important; min-block-size: unset!important; min-height: unset!important; min-inline-size: unset!important; min-width: unset!important; mix-blend-mode: unset!important; object-fit: unset!important; object-position: unset!important; offset: unset!important; opacity: 1; order: unset!important; origin-trial-test-property: unset!important; orphans: unset!important; outline: unset!important; outline-offset: unset!important; overflow-anchor: unset!important; overflow-wrap: unset!important; overflow: unset!important; overscroll-behavior-block: unset!important; overscroll-behavior-inline: unset!important; overscroll-behavior: unset!important; padding-block: unset!important; padding: unset!important; padding-inline: unset!important; page: unset!important; page-orientation: unset!important; paint-order: unset!important; perspective: unset!important; perspective-origin: unset!important; pointer-events: unset!important; position: unset!important; quotes: unset!important; r: unset!important; resize: unset!important; ruby-position: unset!important; rx: unset!important; ry: unset!important; scroll-behavior: unset!important; scroll-margin-block: unset!important; scroll-margin: unset!important; scroll-margin-inline: unset!important; scroll-padding-block: unset!important; scroll-padding: unset!important; scroll-padding-inline: unset!important; scroll-snap-align: unset!important; scroll-snap-stop: unset!important; scroll-snap-type: unset!important; shape-image-threshold: unset!important; shape-margin: unset!important; shape-outside: unset!important; shape-rendering: unset!important; size: unset!important; speak: unset!important; stop-color: unset!important; stop-opacity: unset!important; stroke: unset!important; stroke-dasharray: unset!important; stroke-dashoffset: unset!important; stroke-linecap: unset!important; stroke-linejoin: unset!important; stroke-miterlimit: unset!important; stroke-opacity: unset!important; stroke-width: unset!important; tab-size: unset!important; table-layout: unset!important; text-align: unset!important; text-align-last: unset!important; text-anchor: unset!important; text-combine-upright: unset!important; text-decoration: unset!important; text-decoration-skip-ink: unset!important; text-indent: unset!important; text-overflow: unset!important; text-shadow: unset!important; text-size-adjust: unset!important; text-transform: unset!important; text-underline-offset: unset!important; text-underline-position: unset!important; touch-action: unset!important; transform: unset!important; transform-box: unset!important; transform-origin: unset!important; transform-style: unset!important; transition: opacity 200ms ease-in-out 0ms; user-select: unset!important; vector-effect: unset!important; vertical-align: unset!important; visibility: unset!important; -webkit-app-region: unset!important; border-spacing: unset!important; -webkit-border-image: unset!important; -webkit-box-align: unset!important; -webkit-box-decoration-break: unset!important; -webkit-box-direction: unset!important; -webkit-box-flex: unset!important; -webkit-box-ordinal-group: unset!important; -webkit-box-orient: unset!important; -webkit-box-pack: unset!important; -webkit-box-reflect: unset!important; -webkit-highlight: unset!important; -webkit-hyphenate-character: unset!important; -webkit-line-break: unset!important; -webkit-line-clamp: unset!important; -webkit-mask-box-image: unset!important; -webkit-mask: unset!important; -webkit-mask-composite: unset!important; -webkit-perspective-origin-x: unset!important; -webkit-perspective-origin-y: unset!important; -webkit-print-color-adjust: unset!important; -webkit-rtl-ordering: unset!important; -webkit-ruby-position: unset!important; -webkit-tap-highlight-color: unset!important; -webkit-text-combine: unset!important; -webkit-text-decorations-in-effect: unset!important; -webkit-text-emphasis: unset!important; -webkit-text-emphasis-position: unset!important; -webkit-text-fill-color: unset!important; -webkit-text-security: unset!important; -webkit-text-stroke: unset!important; -webkit-transform-origin-x: unset!important; -webkit-transform-origin-y: unset!important; -webkit-transform-origin-z: unset!important; -webkit-user-drag: unset!important; -webkit-user-modify: unset!important; white-space: unset!important; widows: unset!important; width: unset!important; will-change: unset!important; word-break: unset!important; word-spacing: unset!important; x: unset!important; y: unset!important; z-index: unset!important;"
const englishToLatinDuolingo = {'they do sleep': ['dormiunt'], 'dance': ['saltare', 'saltant', 'saltatis'], 'sleep': ['dormis', 'dormiunt', 'dormit', 'dormimus', 'dormire', 'dormitis', 'dormio'], 'chair': ['sella', 'sellam'], 'children': ['pueri', 'filios', 'filii'], 'father': ['patrem', 'pater'], 'under': ['sub'], 'pleasing': ['placet'], 'the lunch': ['prandium'], 'very': ['valde'], 'rise': ['ascendunt', 'ascendere'], 'do I visit?': ['visito'], 'fat': ['pingues', 'pinguem', 'pinguis'], 'wave': ['unda', 'undam'], 'sons': ['filios', 'filii'], 'worst': ['pessimus', 'pessimi', 'pessima'], 'parrot': ['psittacum', 'psittacus', 'psittaco'], 'to paint': ['pingere'], 'villa': ['villam', 'villa'], 'to sing': ['cantare'], 'second': ['secundum', 'secunda', 'secundam', 'secundus'], 'a client': ['cliens'], 'what': ['quam', 'quid'], 'sweetly': ['suaviter'], 'can': ['potest', 'possum', 'posse', 'potestis', 'possunt'], 'you study': ['studetis', 'studes'], 'doing': ['se habet', 'agit'], 'young man': ['iuvenem', 'iuvenis'], 'water': ['aquam', 'aqua'], 'a head of the house': ['paterfamilias'], 'sing': ['cantatis', 'cantare', 'cantant'], 'teacher': ['magistram', 'magistrum', 'magister', 'magistra'], 'boy': ['Puer'], 'forum': ['foro', 'forum'], 'healthy': ['sanae', 'sanos', 'sanus', 'sanum', 'sana'], 'study': ['studemus', 'tablino', 'studet', 'student'], 'bookkeeper': ['ratiocinator', 'ratiocinatorem'], 'the sons': ['filii'], 'climb': ['ascendunt', 'ascendere', 'ascenditis'], 'the hour': ['hora', 'horam'], 'a lararium': ['lararium'], 'a cookie': ['crustulum'], 'to rise': ['ascendere'], 'market': ['foro', 'forum'], 'senile': ['senilem', 'senilis', 'seniles'], 'angry': ['irati', 'irato', 'irata', 'iratae', 'iratos', 'iratas', 'iratus', 'iratum'], 'to wash': ['lavare'], 'to her': ['ei'], 'live': ['habitas', 'habitant', 'habitat', 'habito'], 'in New York': ['Novi Eboraci'], 'is': ['estne', 'est', 'agit'], 'surely not': ['num'], 'American': ['americanus', 'americana'], 'the female teacher': ['magistra'], 'orator': ['orator', 'oratorem'], 'the human': ['homo', 'hominem'], 'me': ['me', 'mihi', 'ad me'], 'hour': ['hora', 'horam'], 'this': ['is', 'hic', 'hoc', 'haec'], 'you all are': ['estis'], 'learn': ['discunt', 'disco'], 'my': ['meas', 'mea', 'britannia', 'meos', 'meo', 'mihi', 'mei', 'meus', 'meum', 'meae', 'meam'], 'patron': ['patronum', 'patronus'], 'to destroy': ['delere'], 'fish sauce': ['garum'], 'I come': ['venio'], 'salty': ['salsos', 'salsus', 'salsi', 'salsum', 'salsa', 'salsam'], 'to collect': ['colligere'], 'sit': ['sedere', 'sedes', 'sedetis', 'sedemus', 'sedent'], 'he lives': ['habitat'], 'you go': ['is', 'itis'], 'you are going': ['is', 'itis'], 'sacrifice': ['sacrifico', 'sacrificatis', 'donum', 'sacrificas', 'sacrificant', 'sacrificare'], 'after': ['post'], 'you found': ['condis'], 'she builds': ['condit'], 'as well': ['quoque'], 'third': ['tertium', 'tertia', 'tertiam', 'tertius'], 'so': ['sic', 'tam'], 'are living': ['habitant'], 'wine': ['vinum'], 'Neptune, god of the sea': ['neptunus'], 'office': ['tablinum', 'tablino'], 'you visit': ['visitas', 'visitatis'], 'before': ['ante'], 'rapidly': ['rapide'], 'is there': ['estne'], 'I establish': ['condo'], 'paterfamilias': ['paterfamilias'], 'lunch': ['prandium'], 'bread': ['panis', 'panem', 'pane'], 'bacchus': ['Bacchus', 'Bacchum'], 'a biscuit': ['crustulum'], 'the lararium': ['lararium'], 'are you visiting?': ['visitas'], 'to you': ['tibi', 'vobis'], 'beneath': ['sub'], 'we are studying': ['studemus'], 'house': ['domum', 'villam', 'domus', 'villa'], 'fish': ['pisces', 'piscis', 'piscem'], 'with bread': ['pane'], 'the state': ['civitas'], 'is he': ['estne', 'est'], 'god': ['deus'], 'they live': ['habitant'], 'without doubt': ['sine dubio'], 'to climb': ['ascendere'], 'red': ['rubrum'], 'he visits': ['visitat'], 'Minerva': ['minerva', 'minervam'], 'Neptune': ['Neptunus', 'Neptunum'], 'the brothers': ['fratres'], 'cookie': ['crustulum'], 'conversation': ['colloquium'], 'we have': ['habemus'], 'female students': ['discipulae', 'discipulas'], 'she visits': ['visitat'], 'cheese': ['caseum', 'caseus'], 'wash': ['lavas', 'lavatis', 'lavant', 'lavo', 'lavare'], 'a doll': ['pupa'], 'to send': ['mittere'], 'ring': ['anulum', 'anulus'], 'lararium': ['larario', 'lararium'], 'city': ['urbs', 'urbe', 'urbem'], 'tired': ['fessum', 'fessa', 'fessi', 'fessae', 'fessus'], 'girls': ['puellas', 'puellae'], 'paint': ['pingunt', 'pingit', 'pingo', 'pingere', 'pingitis'], 'too': ['nimis', 'quoque'], 'stuffed': ['farta', 'fartus'], 'white': ['candidas', 'candidus', 'candidae', 'candida', 'candidum', 'candidam'], 'man': ['vir', 'virum'], 'the bath': ['balneum', 'balneo'], 'we study': ['studemus'], 'Female doctor': ['medicam', 'medica'], 'kind': ['benignae', 'benigna', 'benignam', 'benigni', 'benignum', 'benignus'], 'tavern': ['taberna', 'tabernam'], 'a professor': ['professor'], 'bed': ['lectum', 'lectus', 'lecto'], 'New York': ['Novum Eboracum'], 'you are visiting': ['visitas', 'visitatis'], 'bridge': ['pontem', 'pons', 'ponte'], 'have': ['habeo', 'habet', 'habemus', 'habetis', 'habent'], 'aged': ['senilem', 'senilis', 'seniles'], 'a father': ['patrem', 'pater'], 'that': ['is', 'ille', 'illum', 'illa'], 'also': ['quoque'], 'build': ['condit', 'construit', 'condis', 'construunt'], 'she is': ['est', 'ea est'], 'destroy': ['delent', 'delet', 'delere'], 'we do have': ['habemus'], 'it pleases': ['placet'], 'to dance': ['saltare'], 'you build': ['construitis', 'construis', 'condis'], 'we are': ['sumus'], 'by chance': ['forte'], 'shop': ['taberna', 'tabernam', 'cauponam'], 'pleases': ['placet'], 'the toilet': ['latrina'], 'bedroom': ['cubiculo', 'cubiculum'], 'it is': ['est'], 'fifth': ['quintum', 'quinta', 'quintam', 'quintus'], 'unhappy': ['miser', 'miseri', 'miserum', 'misera'], 'rich': ['pecuniosum', 'pecuniosae', 'pecuniosi', 'pecuniosam', 'pecuniosus', 'pecuniosa'], 'his': ['suum', 'ei', 'eius', 'suam'], 'you establish': ['condis'], 'would you like': ['velitis', 'velisne'], 'I found': ['condo'], 'do you have': ['habesne', 'habetis'], 'gem': ['gemma', 'gemmam'], 'enemy': ['hostis', 'hostem'], 'hello': ['salvete', 'salve'], 'worried': ['sollicitae', 'sollicitos', 'sollicitum', 'sollicitus', 'sollicitas', 'sollicita', 'solliciti'], 'sacrifices': ['dona', 'sacrificat', 'sacrificare'], 'bathhouse': ['balneum', 'balneo'], 'head of the house': ['paterfamilias'], 'husband': ['maritus', 'maritum', 'virum'], 'a husband': ['maritum', 'maritus'], 'to walk': ['ambulare'], 'are': ['suntne', 'es', 'sunt'], 'the mother': ['mater', 'matrem'], 'are sleeping': ['dormiunt'], 'visiting': ['visitat', 'visitamus'], 'state': ['civitas'], 'you live': ['habitas', 'habitatis'], 'we': ['nos'], 'the old man': ['senem', 'senex'], 'the cities': ['urbes'], 'the dinner': ['cena'], 'tub': ['labro', 'labrum'], 'cities': ['urbes'], 'ham': ['pernam', 'perna'], 'many': ['multas', 'multa', 'multi', 'multae', 'multos'], 'they sleep': ['dormiunt'], 'there is': ['est'], 'drunk': ['ebria', 'ebrii', 'ebrius', 'ebrios', 'ebrium', 'ebrias'], 'walk': ['ambulare', 'ambulamus', 'ambulatis', 'ambulant'], 'table': ['mensam', 'mensa'], 'speak': ['loquuntur', 'loquor'], 'olives': ['olivae', 'olivas'], 'you have': ['habes', 'habetis'], 'Neptunus': ['Neptunus', 'Neptunum'], 'quickly': ['rapide', 'celeriter'], 'to sacrifice': ['sacrificare'], 'a forum': ['foro'], 'the biscuit': ['crustulum'], 'I am coming': ['venio'], 'I do come': ['venio'], 'fire': ['ignem', 'ignis', 'igne'], 'surely does not': ['num'], 'toga': ['togam', 'toga'], 'the cookie': ['crustulum'], 'the water': ['aqua'], 'irate': ['iratus'], 'an old man': ['senex'], 'is it': ['estne'], 'I read': ['lego'], 'sleeping': ['dormiunt'], 'we live': ['habitamus'], 'doctor': ['medicus', 'medicam', 'medica', 'medicum'], 'perhaps': ['forte', 'fortasse'], 'daughters': ['filiae', 'filias'], 'a library': ['bibliotheca'], 'we are living': ['habitamus'], 'student': ['discipulus', 'discipulo', 'discipula'], 'he builds': ['condit'], 'by bread': ['pane'], 'a young man': ['iuvenem', 'iuvenis'], 'client': ['cliens'], 'a chair': ['sella'], 'mother': ['mater', 'matrem'], 'the daughters': ['filiae', 'filias'], 'I would like': ['velim'], 'money': ['pecuniam', 'pecunia'], 'old man': ['senem', 'senex'], 'human': ['homo', 'hominem'], 'Bacchus, god of wine': ['bacchus', 'bacchum'], 'I visit': ['visito'], 'The enemy': ['hostis'], 'read': ['lege', 'legite', 'legere', 'legitis', 'legunt', 'legit'], 'a thief': ['fur'], 'to him': ['ei'], 'early': ['mane'], 'I am visiting': ['visito'], 'I am learning': ['disco'], 'gift': ['donum'], 'a human': ['homo'], 'collect': ['colligere', 'colligitis', 'colligunt'], 'it lives': ['habitat'], 'to exclaim': ['exclamare'], 'often': ['saepe'], 'doll': ['pupa', 'pupam'], 'thief': ['furem', 'fur'], 'library': ['bibliothecam', 'bibliotheca'], 'to sit': ['sedere'], 'Mars': ['mars'], 'the fish sauce': ['garum'], 'household shrine': ['larario', 'lararia', 'lararium'], 'to hand over': ['tradere'], 'there are': ['sunt'], 'to read': ['legere'], 'biscuit': ['crustulum'], 'the husband': ['maritus'], 'dinner': ['cena', 'cenam'], 'greatly': ['valde'], 'owl': ['bubonem', 'bubo'], 'the father': ['patrem', 'pater'], 'bath': ['balneum', 'balneo'], 'to eat': ['comedere'], 'your': ['tuum', 'tuam', 'tuo', 'tuos', 'tuae', 'tui', 'vestra', 'vestrum', 'tuas', 'tua', 'tibi', 'vestri', 'tuus', 'vester'], 'it is pleasing': ['placet'], 'I am reading': ['lego'], 'hand over': ['tradunt', 'tradere'], 'her': ['eius', 'ei', 'suam', 'illam', 'suum', 'se'], 'strict': ['severus', 'severa', 'severam', 'severi', 'severum'], 'accountant': ['ratiocinator', 'ratiocinatorem'], 'happy': ['laetus', 'laeti', 'laeto', 'laeta', 'laetum'], 'offering': ['donum'], 'a mother': ['mater', 'matrem'], 'hi': ['salve'], 'Actor': ['histrio', 'histrionem'], 'eat': ['comedere'], 'he': ['is', 'hic', 'ille'], 'builds': ['condit', 'construit'], 'us': ['nos'], 'to fill': ['implere'], 'they are': ['sunt'], 'toilet': ['latrina'], 'walks': ['ambulat', 'ambulare'], 'fill': ['impletis', 'implere', 'implent'], 'I usually': ['soleo'], 'male students': ['discipuli', 'discipulos'], 'book': ['liber', 'volumine', 'volumen', 'libro', 'librum'], 'sick': ['aegra', 'aegri', 'aegros', 'aeger', 'aegram', 'aegrum'], 'you': ['tu', 'tibi', 'te', 'vos'], 'I build': ['condo'], 'brothers': ['fratres'], 'students': ['discipulas', 'discipulae', 'discipuli', 'discipulos'], 'visits': ['visitat'], 'surely is not': ['num'], 'you are studying': ['studetis', 'studes'], 'you all': ['vos'], 'Spanish': ['hispanice'], 'in Spanish': ['hispanice'], 'scroll': ['volumen', 'volumine']}
const englishToLatinEntries = Object.entries(englishToLatinDuolingo)

// Sort entries so longer entries come up first. So we match the longest text if it includes multiple words
englishToLatinEntries.sort(([english], [english2]) => {
	return english2.length - english.length
})
console.log('englishToLatinEntries', englishToLatinEntries)
// case insensitive contains
jQuery.expr[':'].icontains = function(a, i, m) {
	return jQuery(a).text().toUpperCase()
		.indexOf(m[3].toUpperCase()) >= 0;
  }

const buildKnownEnglishWordsSelector = () => {	
	const englishCssQueries = englishToLatinEntries.map(([ english ]) => {
		return `*:icontains("${english}")`
	})

	// combine the individiual queries into one massive query with a comma
	return englishCssQueries.join(',')
}
const knownEnglishWordsSelector = buildKnownEnglishWordsSelector()
const injectedCssClasses = '.latin-to-english-wrapper,.latin-to-english,.latin-to-english-tooltip-text'

const getInnerMostEnglishElements = (containerSelector) => {
	if ($(containerSelector).is(injectedCssClasses)) {
		console.log('returning early', $(containerSelector))
		// return nothing
		return $(null)
	}

	const allEnglishMatchedElements = $(containerSelector).find(knownEnglishWordsSelector)
	const innermostEnglishElements = allEnglishMatchedElements.not(allEnglishMatchedElements.has(allEnglishMatchedElements))

	// filter out any english words that have already been switched (useful if the english and latin are the same)
	const innermostWithoutMarked = innermostEnglishElements.not(injectedCssClasses).not(innermostEnglishElements.has(injectedCssClasses))
	console.log('innermostWithoutMarked', innermostWithoutMarked)
	return innermostWithoutMarked
}

// match a single english phrase
const createIndividuaEnglishRegexString = (english, latinWords) =>
	// select english phrases, match at word breaks
	`(\\b${english}\\b)`

// match a single english phrase with regex
const createIndividualEnglishRegex = (english, latinWords) => {
	const individualEnglishRegex = createIndividuaEnglishRegexString(english, latinWords)
	// wrap in parenthesis, so we can match a single english phrase later and replace their name
	return new RegExp(`(${individualEnglishRegex})`, 'gi')
}

const buildAllEnglishPhrasesRegex = () => {
	// Build regex to search for any of the english phrases names https://stackoverflow.com/a/185529/3500171

	const englishPhraseRegexStr = englishToLatinEntries
		.map(([english, latinWords]) => createIndividuaEnglishRegexString(english, latinWords)) // (surely is not)
		.join('|') // (surely is not)|(Actor)

	// wrap in parenthesis, so we can match a single english phrases later and replace their name
	// NOTE: Must include 'g' if we want to only match the full pattern
	// include i so it is case insesitive
	return new RegExp(`(${englishPhraseRegexStr})`, 'gi')
}
const allEnglishPhrasesRegex = buildAllEnglishPhrasesRegex()


const findSpecificEnglishPhrase = (text) => {
	let individualEnglishPhraseRegex

	// search for the specific possible english phrase we matched, so we can verify they are an english phrase
	const specificEnglishToLatin = englishToLatinEntries.find(([englishPhrase, latinWords]) => {
		individualEnglishPhraseRegex = createIndividualEnglishRegex(englishPhrase, latinWords)
		
		const currentEnglishPhraseMatches = text.match(individualEnglishPhraseRegex)
		// if the current english phrase matches contains the potential traitor we matched, then we found the object we are looking for

		return currentEnglishPhraseMatches && currentEnglishPhraseMatches.length > 0
	})

	return { specificEnglishToLatin, specificEnglishToLatinRegex: individualEnglishPhraseRegex }
}


// https://stackoverflow.com/a/1026087/3500171
function capitalizeFirstLetter(string) {
	return string.charAt(0).toUpperCase() + string.slice(1);
  }

const replaceWords = (innerMostNode) => {
	const text = innerMostNode.text()

	// find all potential traitor matches
	const verifiedMatches = text.match(allEnglishPhrasesRegex)
	console.log('verifiedMatches', verifiedMatches)
	
	// if we found possible traitors
	if (verifiedMatches && verifiedMatches.length > 0) {
		
		// console.log('matches', verifiedMatches)
		// // loop through each possible traitor we matched
		for (const match of verifiedMatches) {
			console.log(match)
			
			const { specificEnglishToLatin, specificEnglishToLatinRegex } = findSpecificEnglishPhrase(text)
			console.log(specificEnglishToLatin, specificEnglishToLatinRegex)

		  
			if (specificEnglishToLatin) {
				const [englishPhrase, latinWords] = specificEnglishToLatin
				console.log('about to update text', text)

				const randomIndex = Math.floor(Math.random() * latinWords.length)
				const randomLatinWord = latinWords[randomIndex]

				// If less than 0.2, replace with latin word
				// TODO change 2
				let replacement = Math.random() < 2 ? randomLatinWord : match
				const isCapitalized = match[0] === match[0].toUpperCase()
				if (isCapitalized) {
					replacement = capitalizeFirstLetter(replacement)
					console.log(`Replacing ${match} with ${replacement}`)
				}
				
				const html = `<span class='latin-to-english-wrapper' style=\"${unsetEverything}\">` +
						`<span class='latin-to-english'>` +
							`${replacement}` +
							`<span class="latin-to-english-tooltip-text">${match}</span>` +
						`</span>` +
					`</span>`
				

				// if we found an english word, replace it with latin
				$(innerMostNode).html(text.replace(specificEnglishToLatinRegex, html));
				
				
			}
			
		}


	}
}

// Select the node that will be observed for mutations
const targetNode = document.querySelector('body');

// Options for the observer (which mutations to observe)
const config = { childList: true, subtree: true };

// Callback function to execute when mutations are observed
const markNewContent = function(mutationsList, observer) {
    for(let mutation of mutationsList) {
        for (let node of mutation.addedNodes) {
			if (!$(node).is(injectedCssClasses)) {
				console.log('in is', $(node))
				// find the english phrases
				getInnerMostEnglishElements(node).each(function () {
					replaceWords($(this))
				})
			}
        }
	}
};

chrome.extension.sendMessage({}, function(response) {
	var readyStateCheckInterval = setInterval(function() {
	if (document.readyState === "complete") {
		clearInterval(readyStateCheckInterval);

		// This part of the script triggers when page is done loading
		 console.log("Latin Context Learner Loaded")
		$(() => {

			// Look for all of our english phrases and replace some of them
			getInnerMostEnglishElements('body')
			  .each(function() {
				replaceWords($(this))
			})			
			
			// Create an observer instance linked to the callback function
			const observer = new MutationObserver(markNewContent);

			// Start observing the target node for configured mutations
			observer.observe(document, config);
		})
	}
	}, 10);
});